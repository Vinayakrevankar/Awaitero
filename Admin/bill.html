<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <link rel="icon" type="image/png" href="img/logo.png" />
    <title>Awaitero</title>

    <link
      href="vendor/fontawesome-free/css/all.min.css"
      rel="stylesheet"
      type="text/css"
    />

    <link href="css/res.css" rel="stylesheet" />

    <link href="font/stylesheet.css" rel="stylesheet" />

    <link
      href="vendor/mdi-icons/css/materialdesignicons.min.css"
      rel="stylesheet"
    />

    <link href="css/custom.css" rel="stylesheet" />

    <script src="js/jquery.min.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/additional-methods.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/js/bootstrap-datepicker.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"
      integrity="sha512-WFN04846sdKMIP5LKNphMaWzU7YpMyCU245etK3g/2ARYbPK9Ub18eG+ljU96qKRCWh+quCY7yefSmlkQw1ANQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.24.0/axios.min.js"
      integrity="sha512-u9akINsQsAkG9xjc1cnGF4zw5TFDwkxuc9vUp5dltDWYCSmyd0meygbvgXrlc/z7/o4a19Fb5V0OUE58J7dcyw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <!-- <script src="app.js"></script> -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"
      integrity="sha512-CNgIRecGo7nphbeZ04Sc13ka07paqdeTu0WR1IM4kNcpmBAUSHSQX0FslNhTDadL4O5SAGapGt4FodqL8My0mA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/printThis/1.15.0/printThis.min.js"
      integrity="sha512-d5Jr3NflEZmFDdFHZtxeJtBzk0eB+kkRXWFQqEc1EKmolXjHm2IKCA7kTvXBNjIYzjXfD5XzIjaaErpkZHCkBg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script src="js/socket.io.min.js" crossorigin="anonymous"></script>

    <style>
      table {
        border-collapse: collapse;
      }

      #loader {
        border: 12px solid #f3f3f3;
        border-radius: 50%;
        border-top: 12px solid #444444;
        width: 70px;
        height: 70px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        100% {
          transform: rotate(360deg);
        }
      }

      .center {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        margin: auto;
      }
    </style>
  </head>

  <body id="page-top">
    <div id="loader" class="center"></div>
    <div id="wrapper">
      <div id="content-wrapper" class="d-flex flex-column">
        <div id="content" class="justify-content-center">
          <div class="container-fluid">
            <div>
              <h5 style="text-align: center; color: red" id="ErrorMessage"></h5>
              <hr />
            </div>

            <div class="mt-10 bg-white p-2 rounded shadow position-relative">
              <br />
              <div
                class="d-flex justify-content-center"
                style="margin-left: 0%"
              >
                <div class="col-md-6 col-lg-6 mt-2" id="ItemTable">
                  <div class="bg-white shadow-sm p-3 rounded mb-4">
                    <div class="d-flex justify-content-center">
                      <img
                        src="img/logoWithName.svg"
                        style="width: 150px; height: 100"
                      />
                    </div>
                    <a
                      class="d-flex justify-content-center nav-link btn"
                      id="restaurantDetails"
                      style="color: black"
                    ></a>

                    <a
                      class="font-weight-bold"
                      style="color: black; float: right"
                      id="billNumber"
                    ></a>

                    <div class="d-flex flex-column">
                      <div>
                        <p
                          class="font-weight-bold text-black mb-0"
                          id="customerName"
                        >
                          Name:
                        </p>
                      </div>

                      <!-- <div>
                        <p
                          class="font-weight-bold text-black mb-0"
                          id="customerMobile"
                        >
                          Mobile:
                        </p>
                      </div> -->
                      <div>
                        <p
                          class="font-weight-bold text-black mb-0"
                          id="customerMail"
                        >
                          Mail:
                        </p>
                      </div>
                    </div>

                    <div
                      class="mt-2"
                    >
                      <table
                        class="table table-bordered table-striped table-sm mb-0"
                        style="text-align: center;"
                      >
                        <thead>
                          <tr>
                            <th scope="col">#</th>
                            <th scope="col">Item</th>
                            <th scope="col">Quantity</th>
                            <th scope="col">Amount</th>
                          </tr>
                        </thead>
                        <tbody id="listOfItemOrdered"></tbody>
                      </table>
                    </div>
                    <div class="shadow bg-white rounded p-3 clearfix mt-1">
                      <h6>
                        <p class="mb-1">
                          Item Total
                          <span
                            class="float-right text-dark"
                           
                            id="totalAmountView"
                          ></span>
                        </p>
                      </h6>
                    </div>
                    <div
                      class="shadow bg-white rounded p-3 clearfix mt-1"
                      id="ShowIfExists"
                    >
                      <p class="mb-1">
                        CGST
                        <span class="float-right text-dark" id="CGST"></span>
                      </p>
                      <p class="mb-1">
                        SGST
                        <span class="float-right text-dark" id="SGST"></span>
                      </p>
                      <p class="mb-1">
                        Round Off
                        <span
                          class="float-right text-dark"
                          id="roundoff"
                        ></span>
                      </p>
                      <h6>
                        <p class="mb-1">
                          Total Amount
                          <span
                            class="float-right text-dark"
                            id="totalAmount"
                          ></span>
                        </p>
                      </h6>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script
      src="vendor/jquery/jquery.min.js"
      type="733a478407262b07af967949-text/javascript"
    ></script>
    <script
      src="vendor/bootstrap/js/bootstrap.bundle.min.js"
      type="733a478407262b07af967949-text/javascript"
    ></script>

    <script
      src="vendor/jquery-easing/jquery.easing.min.js"
      type="733a478407262b07af967949-text/javascript"
    ></script>

    <script
      src="js/res.min.js"
      type="733a478407262b07af967949-text/javascript"
    ></script>

    <script
      src="js/rocket-loader.min.js"
      data-cf-settings="733a478407262b07af967949-|49"
      defer=""
    ></script>

    <script>
    const domain = "https://awaitero.com:3004";
function getParameterByName(name, url = window.location.href) {
  name = name.replace(/[\[\]]/g, "\\$&");
  var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
    results = regex.exec(url);
  if (!results) return null;
  if (!results[2]) return "";
  return decodeURIComponent(results[2].replace(/\+/g, " "));
}
async function Axios(BaseURL, URL, method, data = null) {
  let tokenStr = JSON.parse(sessionStorage.getItem("token"))
  result = await new Promise((resolve, reject) => {
    axios({
      method: method,
      url: `${BaseURL}${URL}`,
      data: data,
      headers: {"Authorization" : `Bearer ${tokenStr}`}
    })
      .then(function (data) {
        resolve(data);
      })
      .catch((err) => reject(err));
  });
  let res = result.data;
  if (res.status == 401) {
    sessionStorage.clear()
    alert("Unauthorized Access. Please login")
    window.location ="/Admin/index.html"
  }else{
    return result
  }
}

      $(document).ready(function () {
        document.querySelector("body").style.visibility = "hidden";
        document.querySelector("#loader").style.visibility = "visible";
        (async () => {
          const BaseURL = domain; //"http://localhost:3004/api"
          const BaseURLSuperUser = BaseURL + "/api/superAdmin";
          let idBill = getParameterByName("idBill");
          let result = await Axios(BaseURLSuperUser, `/bill/${idBill}`, "GET");
          let res = result.data;
          if (res.status != 200) {
            $("#ErrorMessage").text(res.errorMessage);
            return false;
          } else if(res.status == 200) {
            if (res.payload.length) {
              let totalAmount = 0;
              obj = res.payload.reduce(function (r, a) {
                r[a.idItem] = r[a.idItem] || [];
                r[a.idItem].push(a);
                return r;
              }, Object.create(null));
              let restaurantData = res.payload[0];
              $("#customerName").append(restaurantData.name);
              // $("#customerMobile").append(restaurantData.mobile);
              $("#customerMail").append(restaurantData.email);
              $("#billNumber").append(`Bill No: ${idBill}`);

              $("#restaurantDetails").append(
                `<p>${restaurantData.restaurantName}<br>${
                  restaurantData.address
                }<br>Contact No. ${restaurantData.restaurantNumber}<br><b>${
                  restaurantData.gst ? `GST No.${restaurantData.gst}` : ""
                }</b></p>`
              );

              Object.keys(obj).forEach((v, idx) => {
                let items = obj[v][0];
                itemCount = obj[v].length;
                totalAmount += +items.price * itemCount;

                let modal = `<tr>
                  <th scope="row">${idx + 1}</th>
                  <td>${items.ItemName}</td>
                  <td>${itemCount} x ${items.price}</td>
                  <td><h6>${items.price * itemCount}</h6></td>
                </tr>`;
                $("#listOfItemOrdered").append(modal);

              });
             
              if (restaurantData.gst.length > 1) {
                $("#totalAmount").append(`&#8377;${totalAmount}`);

                let Amount = totalAmount;
                var percent = ((Amount * 5) / 118).toFixed(2); //((9 / 109) * +Amount).toFixed(2);
                totalAmount = (Amount - percent).toFixed(2);
                var GST = (percent / 2).toFixed(2);
                let totalGST = +(GST * 2);
                var roundoff = (Amount - (+totalAmount + +totalGST)).toFixed(2);

                $("#CGST").empty();
                $("#SGST").empty();

                $("#totalAmountView").empty();
                $("#roundoff").empty();
                $("#totalAmount").empty();

                $("#CGST").append("&#8377;" + GST);
                $("#SGST").append("&#8377;" + GST);
                $("#totalAmountView").append("&#8377;" + `${totalAmount}`);

                $("#roundoff").append("&#8377;" + Math.abs(roundoff));
                $("#totalAmount").append(
                  "&#8377;" + (+totalAmount + +totalGST + +roundoff).toFixed(2)
                );
                $("#ShowIfExists").show();
              } else {
                $("#ShowIfExists").hide();
                $("#CGST").hide();
                $("#SGST").hide();
                $("#totalAmountView").append("&#8377;" + `${totalAmount}`);

                $("#roundoff").hide();
                $("#totalAmount").append(`&#8377;${totalAmount}`);
              }
            }else {
              alert("No Bill Found");
              window.location = domain;
            }
            document.querySelector("#loader").style.display = "none";
              document.querySelector("body").style.visibility = "visible";
            }
            
        })();
    });
    </script>
  </body>
</html>
